<!DOCTYPE html>
<!-- 文書の種類をHTMLと宣言する -->
<html lang="ja">
<!-- 言語を日本語に設定する -->

<head>
  <!-- ページの設定情報（画面には表示されない） -->
  <meta charset="UTF-8">
  <!-- 文字コードをUTF-8（日本語対応）に設定する -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- スマホでも見やすいように画面サイズを自動調整する -->
  <title>町内会計管理アプリ</title>
  <!-- ブラウザのタブに表示されるタイトル -->
  <link rel="stylesheet" href="style.css">
  <!-- スタイルシート（デザインファイル）を読み込む -->
</head>

<body>
  <!-- 画面に表示される内容はすべてbodyの中に書く -->

  <!-- ===== ヘッダー：アプリのタイトル ===== -->
  <header class="header">
    <h1 class="header__title">🏘️ 町内会計管理アプリ</h1>
    <p class="header__subtitle">26世帯の収支をかんたん管理</p>
  </header>

  <!-- ===== ナビゲーション：タブ切り替えメニュー ===== -->
  <nav class="nav">
    <!-- タブボタン（クリックでページ内のセクションを切り替える） -->
    <button class="nav__btn nav__btn--active" data-tab="input">
      ✏️ 収支入力
    </button>
    <button class="nav__btn" data-tab="list">
      📋 一覧
    </button>
    <button class="nav__btn" data-tab="summary">
      📊 集計
    </button>
    <button class="nav__btn" data-tab="export">
      📥 CSV出力
    </button>
  </nav>

  <!-- ===== メインコンテンツ ===== -->
  <main class="main">

    <!-- タブ1：収支入力フォーム（Phase 2） -->
    <section class="tab-content tab-content--active" id="tab-input">
      <h2 class="section__title">収支を入力する</h2>

      <!-- 入力フォーム全体 -->
      <form class="form" id="transaction-form">

        <!-- 日付 -->
        <div class="form__group">
          <label class="form__label" for="input-date">日付 <span class="form__required">必須</span></label>
          <input class="form__input" type="date" id="input-date" required>
        </div>

        <!-- 種別（収入 or 支出） -->
        <div class="form__group">
          <label class="form__label">種別 <span class="form__required">必須</span></label>
          <div class="form__radio-group">
            <!-- 収入ラジオボタン -->
            <label class="form__radio-label form__radio-label--income">
              <input type="radio" name="type" value="income" checked>
              収入
            </label>
            <!-- 支出ラジオボタン -->
            <label class="form__radio-label form__radio-label--expense">
              <input type="radio" name="type" value="expense">
              支出
            </label>
          </div>
        </div>

        <!-- カテゴリ（種別に応じて選択肢が変わる） -->
        <div class="form__group">
          <label class="form__label" for="input-category">カテゴリ <span class="form__required">必須</span></label>
          <select class="form__select" id="input-category" required>
            <!-- app.js から動的に選択肢を入れる -->
          </select>
        </div>

        <!-- 金額 -->
        <div class="form__group">
          <label class="form__label" for="input-amount">金額（円） <span class="form__required">必須</span></label>
          <input class="form__input" type="number" id="input-amount" min="1" placeholder="例：5000" required>
        </div>

        <!-- 摘要（任意） -->
        <div class="form__group">
          <label class="form__label" for="input-note">摘要 <span class="form__optional">任意</span></label>
          <input class="form__input" type="text" id="input-note" placeholder="例：1月分、〇〇購入">
        </div>

        <!-- 登録ボタン -->
        <button class="form__submit" type="submit">登録する</button>

      </form>

      <!-- 登録後のメッセージ表示エリア（初期は非表示） -->
      <p class="form__message" id="form-message"></p>

    </section>

    <!-- タブ2：収支一覧（Phase 3） -->
    <section class="tab-content" id="tab-list">
      <h2 class="section__title">収支一覧</h2>

      <!-- 残高サマリーエリア -->
      <div class="balance">
        <div class="balance__item balance__item--income">
          <span class="balance__label">収入合計</span>
          <span class="balance__amount" id="total-income">¥0</span>
        </div>
        <div class="balance__item balance__item--expense">
          <span class="balance__label">支出合計</span>
          <span class="balance__amount" id="total-expense">¥0</span>
        </div>
        <div class="balance__item balance__item--net">
          <span class="balance__label">残高</span>
          <span class="balance__amount" id="total-net">¥0</span>
        </div>
      </div>

      <!-- 収支一覧テーブル -->
      <div class="table-wrap">
        <table class="table" id="transaction-table">
          <thead>
            <tr>
              <th>日付</th>
              <th>種別</th>
              <th>カテゴリ</th>
              <th>金額</th>
              <th>摘要</th>
              <th>削除</th>
            </tr>
          </thead>
          <!-- tbody の中身は app.js で動的に作る -->
          <tbody id="transaction-tbody"></tbody>
        </table>
        <!-- データが0件のときに表示するメッセージ -->
        <p class="placeholder-text" id="no-data-message">まだデータがありません。収支入力タブから登録してください。</p>
      </div>

    </section>

    <!-- タブ3：集計（Phase 4） -->
    <section class="tab-content" id="tab-summary">
      <h2 class="section__title">月別・カテゴリ別集計</h2>

      <!-- データなしメッセージ（初期表示） -->
      <p class="placeholder-text" id="summary-no-data">まだデータがありません。収支入力タブから登録してください。</p>

      <!-- 集計コンテンツ（データあり時に表示） -->
      <div id="summary-content" style="display:none;">

        <!-- 月別集計 -->
        <h3 class="summary__subtitle">月別集計</h3>
        <div class="table-wrap">
          <table class="table" id="monthly-table">
            <thead>
              <tr>
                <th>月</th>
                <th>収入</th>
                <th>支出</th>
                <th>収支</th>
              </tr>
            </thead>
            <tbody id="monthly-tbody"></tbody>
          </table>
        </div>

        <!-- カテゴリ別集計（収入） -->
        <h3 class="summary__subtitle" style="margin-top:32px;">カテゴリ別集計（収入）</h3>
        <div id="income-category-chart"></div>

        <!-- カテゴリ別集計（支出） -->
        <h3 class="summary__subtitle" style="margin-top:32px;">カテゴリ別集計（支出）</h3>
        <div id="expense-category-chart"></div>

      </div>

    </section>

    <!-- タブ4：CSV出力（Phase 5） -->
    <section class="tab-content" id="tab-export">
      <h2 class="section__title">CSV出力（総会レポート）</h2>

      <!-- 出力の説明 -->
      <div class="export-info">
        <p class="export-info__text">登録済みの収支データをCSVファイルで出力します。</p>
        <p class="export-info__text">ExcelやNumbersで開いて総会資料として使用できます。</p>
      </div>

      <!-- 出力内容の選択 -->
      <div class="export-options">

        <!-- 全件出力 -->
        <div class="export-card">
          <h3 class="export-card__title">📄 全件出力</h3>
          <p class="export-card__desc">登録されているすべての収支データを出力します。</p>
          <button class="export-btn export-btn--all" id="btn-export-all">
            CSVダウンロード（全件）
          </button>
        </div>

        <!-- 月別出力 -->
        <div class="export-card">
          <h3 class="export-card__title">📅 月別出力</h3>
          <p class="export-card__desc">指定した月のデータのみを出力します。</p>
          <div class="export-card__row">
            <!-- 月を選択するセレクトボックス（app.jsで選択肢を生成） -->
            <select class="form__select export-month-select" id="select-export-month"></select>
            <button class="export-btn export-btn--month" id="btn-export-month">
              CSVダウンロード
            </button>
          </div>
        </div>

      </div>

      <!-- データ0件のときのメッセージ -->
      <p class="placeholder-text" id="export-no-data" style="display:none;">
        データがありません。収支入力タブから登録してください。
      </p>

    </section>

  </main>

  <!-- ===== フッター ===== -->
  <footer class="footer">
    <p>© 2025 町内会計管理アプリ</p>
  </footer>

  <!-- Supabase：クラウドデータベースに接続するためのライブラリ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- JavaScriptファイルを読み込む（bodyの最後に書くのが定番） -->
  <script src="app.js"></script>
</body>

</html>
